# 基于ssh框架的网上购彩系统
### 完成人：
GodFan
### 开发环境：
eclipse+MySQL+windows7
### 使用的技术架构：
#### Spring+hibernate+Struts+jsoup+JSP
#### 基于java的爬虫技术爬取相关的彩票网页，获取前30期的开奖结果并展示给顾客，通过对开奖结果的分析，获取过去三十期号码中的高频号码、低频号码，最终展示给顾客一注高频号码、一注低频号码、一注幸运号码（机选号码）。 
#### 1、使用Struts2作为核心控制器；
#### 2、使用Spring实现IOC和DI；
#### 3、使用Hibernate访问数据库;
#### 4、使用jsp作为页面展示以及与客户的交互；
#### 5、使用mysql数据库进行数据的存储；
#### 6、使用Jsoup实现网页爬取 
### 项目背景：
#### 1、作为一个忠实的彩民，几乎每期都会购买彩票，但是长期购买后发现，中奖的号码是没有任何规律可循的（任何一注中奖的概率都是相同的，并且概率都是非常小的；
#### 2、就福彩双色球和体彩大乐透来说，双色球中一等奖的概率是：1/17721088相当于1700多万人里面有一个人能中！大乐透一等奖的中奖概率是：1/21425712，相当于2000多万里面有一个人能中！）。
#### 3、经过一段时间与老彩民的沟通交流，发现相当一部分老彩民在购彩时，会先看看往期的开奖结果。而且他们并不是查看往期所有的彩票开奖结果，而是看最近的二三十期开奖结果，从中筛选出一部分出现频率比较高的号码，再筛选一部分出现频率比较低的号码，再加上几个自己认定的号码，作为购彩号码。但是，对于一些人来说，去彩票站购彩，既浪费时间又浪费精力。因此，基于彩民的实际购彩需求，本项目尝试为彩民提供以下帮助：
### 项目功能：
#### 1、查看近期的开奖结果；
#### 2、分析往期（近30期）开奖结果，找出高频号码和低频号码，给彩民给出推荐的彩票号码（基于彩民的购彩心理，给出的推荐号码）；
#### 3、实现用户在网上购彩的功能。 实现功能：
#### 4、用户的注册、登录、添加彩票到购物车、从购物车删除相关彩票、购买、查看历史记录、删除相关记录、追号操作；
#### 5、管理员的注册、登录、对用户的管理（查看所有用户，查看某个用户的个人信息以及购物信息、维护客户的相关信息）。
### 访问流程： 
#### 访问：http://localhost:8080/lottery2  可以实现用户的登录、注册、管理员登录。
### 项目中出现的错误及解决方案：
#### 1、	多次刷新页面，导致页面重复提交；
#### 解决手段： A.	使用重定向手段 在表单提交成功之后，使用重定向来发送目标到新的action或者jsp页面，可以防止因为刷新页面导致的页面重复提交的问题，但是不能解决页面回退导致的重复提交问题，在查看购物车购物历史记录中使用这种方法，因为在遍历集合，没法实现添加token的操作。 B.	使用s:token生成令牌配合token拦截器 在struts2中有一个<s:token/> 标签。该标签通过生成一个独一无二令牌，它会同时放在session和表单的隐藏域中。在进行表单提交时，token拦截器会进行令牌的验证，如果两次的令牌匹配，那么本次表单提交成功，否则提交失败。当struts.xml 中配置的拦截器名称是token时，需要配置返回结果invalid.token的响应界面。提交失败后会出现一个 invalid.token 无效的结果视图。或者在struts.xml中配置拦截器名为tokenSession，此时无序配置相关的结果集，在多次提交表单后，原来的页面不发生任何变化。 
#### 配制方法： (一)	在表单中加入<s:token/>，struts.xml中加入 ；以及对应的结果返回值， /XXXX.jsp,此时当二次提交请求的时候，会转到XXX.jsp。 
#### (二)	在表单中加入<s:token/>，struts.xml中加入 ；以及对应的结果返回值， /XXXX.jsp,此时当二次提交请求的时候，页面不会发生变化。 C.	使用Javascript进行控制，设置一个变量，只允许访问一次（禁止后退）；
#### 2、由于没有在spring中设置action类型（在application.xml中要将bean中设置scope="prototype"），从而导致出现以下错误： No result defined for action com.itgodfan.action.AdminRegisterAction and result input 原因：在SSH中， 当Action中的注入的属性第二次使用没有session时，这是因为spring管理Action默认为单例模式，当第一次使用到了属性，占用了session，所以第二次无法找到。
#### 解决手段：Struts2 会对每个浏览器,产生一个Action的实例来处理.Spring的Ioc容器管理的bean默认是单实例的. 首先从数据安全性的问题上考虑，我们的Action应该保证是多例的，这样才不会出现数据问题。但是如果有的action比如只有admin才能操作，或者某些action，全站公用一个来提高性能，这样的话，就可以使用单例模式。 不过幸好，Spring的bean可以针对每一个设置它的scope，所以，上面的问题就不是问题了。如果用多例，就在spring的action bean配置的时候设置scope="prototype".好吧，问题到此结束。
### 3、	在外层可以输入jsp页面的名称，从而访问相应的页面。 
#### 解决措施：将用到的jsp页面全部防止到web-INF目录下。然后只在项目的启动页面（index.jsp）提供一个访问的入口。对于内部的jsp页面，可以通过与action的交互进行跳转访问，实现了对jsp页面的封装。
### 4、	地址栏输入action后可以访问部分页面； 
### 解决措施： 设置拦截器。通过对所有的地址进行拦截，验证用户是否登录，只有登录的用户才可以访问相关的页面，未登录的用户会直接被迫进行登录或者注册操作，从而保障了访问页面的安全性。 
### 5、	退出操作 在退出账号时要清除session。 

### 还需要完善的：
#### 1、	邀请奖励机制，分为普通用户邀请和管理员邀请，主要用于系统推广期。 a)	管理员或者普通用户可以通过点击邀请码按键来生成邀请码（存在数据库中，一个用户只生成一个邀请码，凡是邀请成功（新的账户用了邀请码），就给与相应的奖励），邀请越多，级别越高，奖励越多。 b)	高级别用户可以享受与专业分析人员交流的机会，或者每月赠送几注彩票。
#### 2、	注册的时候需要手机或邮箱激活，防止虚假注册。 
#### 3、	登录界面加上验证码操作，增加安全性。 
#### 4、	业务还是太简单，没用到多表联查，后期可以拓展。 
#### 5、	支付业务未实现，涉及与相关机构或银行对接。
### 注:
#### 新手入门，代码技术含量极低，错误很多。 本身网上购彩业务是法律不允许的，本项目仅供娱乐！

